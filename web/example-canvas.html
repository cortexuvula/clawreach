<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Example Interactive Canvas</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      min-height: 100vh;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    h1 {
      margin-top: 0;
      font-size: 28px;
    }

    .card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    button {
      background: white;
      color: #667eea;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin: 5px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    button:active {
      transform: translateY(0);
    }

    input[type="text"] {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 16px;
      box-sizing: border-box;
    }

    input[type="text"]::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    #status {
      padding: 10px;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.2);
      font-family: monospace;
      font-size: 14px;
      margin-top: 10px;
      white-space: pre-wrap;
    }

    canvas {
      display: block;
      max-width: 100%;
      border-radius: 8px;
      background: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé® Interactive Canvas Example</h1>

    <div class="card">
      <h3>Actions</h3>
      <p>Click buttons to send actions to ClawReach:</p>
      <button onclick="handleButtonClick('play')">‚ñ∂Ô∏è Play</button>
      <button onclick="handleButtonClick('pause')">‚è∏Ô∏è Pause</button>
      <button onclick="handleButtonClick('stop')">‚èπÔ∏è Stop</button>
    </div>

    <div class="card">
      <h3>Form Submission</h3>
      <input type="text" id="nameInput" placeholder="Enter your name...">
      <br><br>
      <button onclick="handleFormSubmit()">Submit</button>
    </div>

    <div class="card">
      <h3>Events</h3>
      <button onclick="sendCompletionEvent()">‚úÖ Send Completion</button>
      <button onclick="sendErrorEvent()">‚ùå Send Error</button>
    </div>

    <div class="card">
      <h3>Drawing Canvas (for snapshot testing)</h3>
      <canvas id="openclaw-canvas" width="400" height="200"></canvas>
      <br><br>
      <button onclick="drawRandom()">üé≤ Draw Random Shapes</button>
    </div>

    <div class="card">
      <h3>Status</h3>
      <div id="status">Ready...</div>
    </div>
  </div>

  <!-- Include the Canvas Bridge -->
  <script src="openclaw-canvas-bridge.js"></script>

  <script>
    const statusEl = document.getElementById('status');

    function log(message) {
      const timestamp = new Date().toLocaleTimeString();
      statusEl.textContent = `[${timestamp}] ${message}\n` + statusEl.textContent;
    }

    // Handle button clicks
    function handleButtonClick(action) {
      openclawCanvas.sendAction(action, {
        timestamp: Date.now(),
        source: 'button'
      });
      log(`Action sent: ${action}`);
    }

    // Handle form submission
    function handleFormSubmit() {
      const name = document.getElementById('nameInput').value;
      if (!name) {
        log('Error: Please enter a name');
        return;
      }

      openclawCanvas.sendAction('form-submit', {
        name,
        timestamp: Date.now()
      });
      log(`Form submitted: name=${name}`);
      document.getElementById('nameInput').value = '';
    }

    // Send completion event
    function sendCompletionEvent() {
      openclawCanvas.sendEvent('task-completed', {
        task: 'example-task',
        duration: Math.floor(Math.random() * 5000),
        success: true
      });
      log('Completion event sent');
    }

    // Send error event
    function sendErrorEvent() {
      openclawCanvas.sendEvent('error', {
        message: 'Example error occurred',
        code: 'TEST_ERROR'
      });
      log('Error event sent');
    }

    // Draw random shapes on canvas
    function drawRandom() {
      const canvas = document.getElementById('openclaw-canvas');
      const ctx = canvas.getContext('2d');

      // Clear canvas
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw random shapes
      for (let i = 0; i < 10; i++) {
        ctx.fillStyle = `hsl(${Math.random() * 360}, 70%, 60%)`;
        
        if (Math.random() > 0.5) {
          // Circle
          ctx.beginPath();
          ctx.arc(
            Math.random() * canvas.width,
            Math.random() * canvas.height,
            Math.random() * 50 + 10,
            0,
            Math.PI * 2
          );
          ctx.fill();
        } else {
          // Rectangle
          ctx.fillRect(
            Math.random() * canvas.width,
            Math.random() * canvas.height,
            Math.random() * 100 + 20,
            Math.random() * 100 + 20
          );
        }
      }

      log('Drew random shapes');
    }

    // Listen for data from app
    openclawCanvas.onCommand('data', (data) => {
      log(`Received data: ${data.key} = ${JSON.stringify(data.value)}`);
    });

    // Listen for control commands from app
    openclawCanvas.onCommand('control', (data) => {
      log(`Received control: ${data.action}`);
      
      // Handle specific controls
      if (data.action === 'clear-canvas') {
        const canvas = document.getElementById('openclaw-canvas');
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        log('Canvas cleared');
      }
    });

    // Listen for custom data events
    document.addEventListener('openclaw-data', (e) => {
      console.log('Received data event:', e.detail);
    });

    // Listen for custom control events
    document.addEventListener('openclaw-control', (e) => {
      console.log('Received control event:', e.detail);
    });

    // Initial draw
    drawRandom();
    
    log('Example canvas loaded');
  </script>
</body>
</html>
